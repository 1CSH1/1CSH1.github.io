<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.5.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.5.0" />






<meta name="description" content="当才华撑不起野心时，应该静下心来学习；当能力驾驭不了目标时，应该沉下心来历练。">
<meta property="og:type" content="website">
<meta property="og:title" content="1CSH1">
<meta property="og:url" content="https://1csh1.github.io/page/17/index.html">
<meta property="og:site_name" content="1CSH1">
<meta property="og:description" content="当才华撑不起野心时，应该静下心来学习；当能力驾驭不了目标时，应该沉下心来历练。">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="1CSH1">
<meta name="twitter:description" content="当才华撑不起野心时，应该静下心来学习；当能力驾驭不了目标时，应该沉下心来历练。">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>

  <title> 1CSH1 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  





  <script type="text/javascript">
    (function() {
      var hm = document.createElement("script");
      hm.src = "//tajs.qq.com/stats?sId=55186219";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>






  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">1CSH1</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">当才华撑不起野心时，应该静下心来学习；当能力驾驭不了目标时，应该沉下心来历练。</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/21/Thrift IDL基本语法/" itemprop="url">
                  Thrift IDL基本语法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-02-21T20:30:00+08:00" content="2017-02-21">
              2017-02-21
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Thrift/" itemprop="url" rel="index">
                    <span itemprop="name">Thrift</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/02/21/Thrift IDL基本语法/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/02/21/Thrift IDL基本语法/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/02/21/Thrift IDL基本语法/" class="leancloud_visitors" data-flag-title="Thrift IDL基本语法">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>摘要：本文介绍Thrift的IDL基本语法</p>
</blockquote>
<h1 id="IDL"><a href="#IDL" class="headerlink" title="IDL"></a>IDL</h1><blockquote>
<p>Thrift 采用IDL（Interface Definition Language）来定义通用的服务接口，然后通过Thrift提供的编译器，可以将服务接口编译成不同语言编写的代码，通过这个方式来实现跨语言的功能。</p>
</blockquote>
<h1 id="基本类型"><a href="#基本类型" class="headerlink" title="基本类型"></a>基本类型</h1><blockquote>
<p>bool: 布尔值          对应Java中的boolean<br>byte: 有符号字节      对应Java中的byte<br>i16: 16位有符号整型   对应Java中的short<br>i32: 32位有符号整型   对应Java中的int<br>i64: 64位有符号整型   对应Java中的long<br>double: 64位浮点型    对应Java中的double<br>string: 字符串        对应Java中的String<br>binary: Blob 类型     对应Java中的byte[]</p>
</blockquote>
<h1 id="struct-结构体"><a href="#struct-结构体" class="headerlink" title="struct 结构体"></a>struct 结构体</h1><p>struct有以下一些约束：</p>
<blockquote>
<p>1.struct不能继承，但是可以嵌套，不能嵌套自己。<br>2.其成员都是有明确类型<br>3.成员是被正整数编号过的，其中的编号使不能重复的，这个是为了在传输过程中编码使用。<br>4.成员分割符可以是逗号（,）或是分号（;），而且可以混用<br>5.字段会有optional和required之分和protobuf一样，但是如果不指定则为无类型–可以不填充该值，但是在序列化传输的时候也会序列化进去，optional是不填充则部序列化，required是必须填充也必须序列化。<br>6.每个字段可以设置默认值<br>7.同一文件可以定义多个struct，也可以定义在不同的文件，进行include引入。</p>
</blockquote>
<p>例子：</p>
<pre><code>struct User{
  1: required string name, //改字段必须填写
  2: optional i32 age = 0; //默认值
  3: bool gender //默认字段类型为optional
}
</code></pre><p>规则：</p>
<blockquote>
<p>如果required标识的域没有赋值，Thrift将给予提示；<br>如果optional标识的域没有赋值，该域将不会被序列化传输；<br>如果某个optional标识域有缺省值而用户没有重新赋值，则该域的值一直为缺省值；<br>如果某个optional标识域有缺省值或者用户已经重新赋值，而不设置它的__isset为true，也不会被序列化传输。</p>
</blockquote>
<h1 id="Container-容器"><a href="#Container-容器" class="headerlink" title="Container (容器)"></a>Container (容器)</h1><p>有3种可用容器类型：</p>
<blockquote>
<p>list&lt;t&gt;:  元素类型为t的有序表，容许元素重复。对应c++的vector，java的ArrayList或者其他语言的数组<br>set&lt;t&gt;:   元素类型为t的无序表，不容许元素重复。对应c++中的set，java中的HashSet,python中的set，php中没有set，则转换为list类型了<br>map&lt;t, t&gt;: 键类型为t，值类型为t的kv对，键不容许重复。对用c++中的map, Java的HashMap, PHP 对应 array, Python/Ruby 的dictionary</p>
</blockquote>
<p>例子</p>
<pre><code>struct Test {
  1: map&lt;string, User&gt; usermap,
  2: set&lt;i32&gt; intset,
  3: list&lt;double&gt; doublelist
}
</code></pre><h1 id="enum-枚举"><a href="#enum-枚举" class="headerlink" title="enum (枚举)"></a>enum (枚举)</h1><p>约束：</p>
<blockquote>
<p>1.编译器默认从0开始赋值<br>2.可以赋予某个常量某个整数<br>3.允许常量是十六进制整数<br>4.末尾没有分号<br>5.给常量赋缺省值时，使用常量的全称</p>
</blockquote>
<p>规则：</p>
<blockquote>
<p>Thrift不支持枚举类嵌套，枚举常量必须是32位的正整数</p>
</blockquote>
<p>例子：</p>
<pre><code>enum HttpStatus {
  OK = 200,
  NOTFOUND=404
}
</code></pre><h1 id="常量定义"><a href="#常量定义" class="headerlink" title="常量定义"></a>常量定义</h1><p>使用方法：在变量前面加上const</p>
<p>例子：</p>
<pre><code>const i32 const_int = 1;
</code></pre><h1 id="类型定义"><a href="#类型定义" class="headerlink" title="类型定义"></a>类型定义</h1><p>Thrift支持C/C++类型定义</p>
<p>例子：</p>
<pre><code>typedef i32 myint
typedef i64 usernumber
</code></pre><p>规则：</p>
<blockquote>
<p>末尾没有逗号</p>
</blockquote>
<h1 id="Exception-异常"><a href="#Exception-异常" class="headerlink" title="Exception (异常)"></a>Exception (异常)</h1><p>异常在语法和功能上类似于结构体，差别是异常使用关键字exception，而且异常是继承每种语言的基础异常类。</p>
<p>例子：</p>
<pre><code>exception MyException {
    1: i32 errorCode,
    2: string message
}
</code></pre><h1 id="Service-服务定义类型"><a href="#Service-服务定义类型" class="headerlink" title="Service (服务定义类型)"></a>Service (服务定义类型)</h1><p>服务的定义方法在语义上等同于面向对象语言中的接口。</p>
<pre><code>service HelloService {
    i32 sayInt(1:i32 param)
    string sayString(1:string param)
    bool sayBoolean(1:bool param)
    void sayVoid()
}
</code></pre><p>编译后的Java代码</p>
<pre><code>public class HelloService {
  public interface Iface {
    public int sayInt(int param) throws org.apache.thrift.TException;
    public java.lang.String sayString(java.lang.String param) throws org.apache.thrift.TException;
    public boolean sayBoolean(boolean param) throws org.apache.thrift.TException;
    public void sayVoid() throws org.apache.thrift.TException;
  }
  // ... 省略很多代码
}
</code></pre><h1 id="Namespace-名字空间"><a href="#Namespace-名字空间" class="headerlink" title="Namespace (名字空间)"></a>Namespace (名字空间)</h1><blockquote>
<p>Thrift中的命名空间类似于C++中的namespace和java中的package，它们提供了一种组织（隔离）代码的简便方式。名字空间也可以用于解决类型定义中的名字冲突。<br>由于每种语言均有自己的命名空间定义方式（如python中有module）, thrift允许开发者针对特定语言定义namespace：</p>
</blockquote>
<p>例子：</p>
<pre><code>namespace java com.example.test
</code></pre><p>转化成</p>
<pre><code>package com.example.test
</code></pre><h1 id="Comment-注释"><a href="#Comment-注释" class="headerlink" title="Comment (注释)"></a>Comment (注释)</h1><p>Thrift支持C多行风格和Java/C++单行风格。<br>例子：</p>
<pre><code>/** 
 * This is a multi-line comment. 
 * Just like in C. 
 */
 // C++/Java style single-line comments work just as well.
</code></pre><h1 id="Include"><a href="#Include" class="headerlink" title="Include"></a>Include</h1><blockquote>
<p>便于管理、重用和提高模块性/组织性，我们常常分割Thrift定义在不同的文件中。包含文件搜索方式与c++一样。Thrift允许文件包含其它thrift文件，用户需要使用thrift文件名作为前缀访问被包含的对象，</p>
</blockquote>
<p>如：</p>
<pre><code>include &quot;test.thrift&quot;   
...
struct StSearchResult {
    1: in32 uid;
     ...
}
</code></pre><p>thrift文件名要用双引号包含，末尾没有逗号或者分号</p>
<h1 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h1><p><a href="https://www.ibm.com/developerworks/cn/java/j-lo-apachethrift/" target="_blank" rel="noopener">Apache Thrift - 可伸缩的跨语言服务开发框架</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/21/Thrift 入门介绍/" itemprop="url">
                  Thrift 入门技术
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-02-21T19:50:00+08:00" content="2017-02-21">
              2017-02-21
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Thrift/" itemprop="url" rel="index">
                    <span itemprop="name">Thrift</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/02/21/Thrift 入门介绍/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/02/21/Thrift 入门介绍/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/02/21/Thrift 入门介绍/" class="leancloud_visitors" data-flag-title="Thrift 入门技术">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>摘要：本文讲述Thrift的一些基本知识，以及概念。</p>
</blockquote>
<h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><p>&emsp;&emsp;Thrift作为Facebook开源的RPC框架, 通过IDL中间语言, 并借助代码生成引擎生成各种主流语言的rpc框架服务端/客户端代码，主要特点：</p>
<h2 id="开发速度快："><a href="#开发速度快：" class="headerlink" title="开发速度快："></a>开发速度快：</h2><p>&emsp;&emsp;通过编写RPC接口IDL文件，利用编译生成器自动生成Server端骨架(Skeletons)和客户端Stubs，省去开发者自定义和维护接口编解码、消息传输、服务器多线程模型等基础工作；Server端开发者只需按照服务骨架，写好自己的业务处理程序(Handlers)即可，Client端程序只需创建IDL中定义的服务对象，然后就像调用本地对象的方法一样调用远端服务。</p>
<h2 id="接口维护简单高效："><a href="#接口维护简单高效：" class="headerlink" title="接口维护简单高效："></a>接口维护简单高效：</h2><p>&emsp;&emsp;通过维护Thrift格式的IDL(Interface Description Language)文件（注意写好注释），即可作为给Clients使用的接口文档使用，也自动生成接口代码，始终保持代码和文档的一致性。且Thrift协议可灵活支持接口的可扩展性。</p>
<h2 id="学习成本低："><a href="#学习成本低：" class="headerlink" title="学习成本低："></a>学习成本低：</h2><p>&emsp;&emsp;因为其来自Google Protocol Buffers开发团队，所以其IDL文件风格类似Google Protocol Buffers，且更加易读易懂；特别是RPC服务接口的风格就像写一个一般的面向对象的Class一样简单。<br>&emsp;&emsp;初学者只需参照<a href="http://thrift.apache.org/几个小时即可理解和使用Thrift。" target="_blank" rel="noopener">http://thrift.apache.org/几个小时即可理解和使用Thrift。</a></p>
<h2 id="多语言-跨语言支持："><a href="#多语言-跨语言支持：" class="headerlink" title="多语言/跨语言支持："></a>多语言/跨语言支持：</h2><p>&emsp;&emsp;Thrift支持C++, Java, Python, PHP, Ruby, Erlang, Perl, Haskell, C#, Cocoa, JavaScript, Node.js, Smalltalk, OCaml and Delphi等多种语言，即可生成上述语言的服务器端和客户端程序。<br>对于我们经常使用的Java、PHP、Python、C++支持良好，虽然对iOS环境的Objective-C(Cocoa)支持稍逊，但也完全满足我们的使用要求。</p>
<h2 id="已验证成熟稳定："><a href="#已验证成熟稳定：" class="headerlink" title="已验证成熟稳定："></a>已验证成熟稳定：</h2><p>&emsp;&emsp;Thrift在很多开源项目中已经被验证是稳定和高效的，例如Cassandra、Evernode等；在Facebook、Baidu等后台产品中也有使用。</p>
<h1 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h1><h2 id="Thrift-软件栈"><a href="#Thrift-软件栈" class="headerlink" title="Thrift 软件栈"></a>Thrift 软件栈</h2><p>&emsp;&emsp; Thrift对软件栈的定义非常的清晰, 使得各个组件能够松散的耦合, 针对不同的应用场景, 选择不同是方式去搭建服务.<br>&emsp;&emsp; Transport: 传输层，定义数据传输方式，可以为TCP/IP传输，内存共享或者文件共享等<br>&emsp;&emsp; Protocol: 协议层, 定义数据传输格式，可以为二进制或者XML等<br>&emsp;&emsp; Processor: 处理层, 这部分由定义的idl来生成, 封装了协议输入输出流, 并委托给用户实现的handler进行处理.<br>&emsp;&emsp; Server: 服务层, 整合上述组件, 提供网络模型(单线程/多线程/事件驱动), 最终形成真正的服务.</p>
<h2 id="Thrift-对语言的支持"><a href="#Thrift-对语言的支持" class="headerlink" title="Thrift 对语言的支持"></a>Thrift 对语言的支持</h2><p>&emsp;&emsp;Thrift和Google Protobuf相比, 都提供了可扩展序列化机制, 不但兼容性好而且压缩率高. 两者在这块各有长短, 性能上PB稍有优势. 但在语言的支持度上, Protobuf只支持c++/java/python这三种主流的语言, Thrift则几乎覆盖了大部分的语言, 从这点上来说, Thrift的优势非常的明显.</p>
<h2 id="协议"><a href="#协议" class="headerlink" title="协议"></a>协议</h2><p>&emsp;&emsp;Thrift可以让你选择客户端与服务端之间传输通信协议的类别，在传输协议上总体上划分为文本(text)和二进制(binary)传输协议, 为节约带宽，提供传输效率，一般情况下使用二进制类型的传输协议为多数，但有时会还是会使用基于文本类型的协议，这需要根据项目/产品中的实际需求：<br>&emsp;&emsp; TBinaryProtocol – 二进制编码格式进行数据传输。<br>&emsp;&emsp; TCompactProtocol – 这种协议非常有效的，使用Variable-Length Quantity (VLQ) 编码对数据进行压缩。<br>&emsp;&emsp; TJSONProtocol – 使用JSON的数据编码协议进行数据传输。<br>&emsp;&emsp; TSimpleJSONProtocol – 这种节约只提供JSON只写的协议，适用于通过脚本语言解析<br>&emsp;&emsp; TDebugProtocol – 在开发的过程中帮助开发人员调试用的，以文本的形式展现方便阅读。</p>
<h2 id="传输层"><a href="#传输层" class="headerlink" title="传输层"></a>传输层</h2><p>&emsp;&emsp; TSocket- 使用堵塞式I/O进行传输，也是最常见的模式。<br>&emsp;&emsp; TFramedTransport- 使用非阻塞方式，按块的大小，进行传输，类似于Java中的NIO。<br>&emsp;&emsp; TFileTransport- 顾名思义按照文件的方式进程传输，虽然这种方式不提供Java的实现，但是实现起来非常简单。<br>&emsp;&emsp; TMemoryTransport- 使用内存I/O，就好比Java中的ByteArrayOutputStream实现。<br>&emsp;&emsp; TZlibTransport- 使用执行zlib压缩，不提供Java的实现。</p>
<h2 id="服务端类型"><a href="#服务端类型" class="headerlink" title="服务端类型"></a>服务端类型</h2><p>&emsp;&emsp; TSimpleServer -  单线程服务器端使用标准的堵塞式I/O。<br>&emsp;&emsp; TThreadPoolServer -  多线程服务器端使用标准的堵塞式I/O。<br>&emsp;&emsp; TNonblockingServer – 多线程服务器端使用非堵塞式I/O，并且实现了Java中的NIO通道。</p>
<h1 id="Thrift-架构"><a href="#Thrift-架构" class="headerlink" title="Thrift 架构"></a>Thrift 架构</h1><center><br><img src="https://1csh1.github.io/img/Thrift入门介绍/Thrift架构图.jpg" alt="Thrift架构图"><br></center>

<p>&emsp;&emsp;如图所示，图中黄色部分是用户实现的业务逻辑，褐色部分是根据 Thrift 定义的服务接口描述文件生成的客户端和服务器端代码框架，红色部分是根据 Thrift 文件生成代码实现数据的读写操作。红色部分以下是 Thrift 的传输体系、协议以及底层 I/O 通信，使用 Thrift 可以很方便的定义一个服务并且选择不同的传输协议和传输层而不用重新生成代码。<br>&emsp;&emsp;Thrift 服务器包含用于绑定协议和传输层的基础架构，它提供阻塞、非阻塞、单线程和多线程的模式运行在服务器上，可以配合服务器 / 容器一起运行，可以和现有的 J2EE 服务器 /Web 容器无缝的结合。</p>
<h1 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h1><p><a href="http://www.jianshu.com/p/bfd514fd0d6d" target="_blank" rel="noopener">Thrift RPC实战(一) 初次体验Thrift</a><br><a href="https://www.ibm.com/developerworks/cn/java/j-lo-apachethrift/" target="_blank" rel="noopener">Apache Thrift - 可伸缩的跨语言服务开发框架</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/20/Java的静态代理和动态代理/" itemprop="url">
                  Java的静态代理和动态代理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-02-20T22:00:24+08:00" content="2017-02-20">
              2017-02-20
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/02/20/Java的静态代理和动态代理/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/02/20/Java的静态代理和动态代理/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/02/20/Java的静态代理和动态代理/" class="leancloud_visitors" data-flag-title="Java的静态代理和动态代理">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>摘要：本文讲述Java中的静态代理和动态代理，动态代理的2种实现：Java自带的动态代理实现以及Cglib的动态代理实现。</p>
</blockquote>
<h1 id="静态代理"><a href="#静态代理" class="headerlink" title="静态代理"></a>静态代理</h1><blockquote>
<p>由程序员创建或工具生成代理类的源码，再编译代理类。所谓静态也就是在程序运行前就已经存在代理类的字节码文件，代理类和委托类的关系在运行前就确定了。</p>
</blockquote>
<h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">//User实体类</span><br><span class="line">public class User &#123;</span><br><span class="line">	</span><br><span class="line">	private int id;</span><br><span class="line">	private String name;</span><br><span class="line">	private int age;</span><br><span class="line">	</span><br><span class="line">	public int getId() &#123;</span><br><span class="line">		return id;</span><br><span class="line">	&#125;</span><br><span class="line">	public void setId(int id) &#123;</span><br><span class="line">		this.id = id;</span><br><span class="line">	&#125;</span><br><span class="line">	public String getName() &#123;</span><br><span class="line">		return name;</span><br><span class="line">	&#125;</span><br><span class="line">	public void setName(String name) &#123;</span><br><span class="line">		this.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	public int getAge() &#123;</span><br><span class="line">		return age;</span><br><span class="line">	&#125;</span><br><span class="line">	public void setAge(int age) &#123;</span><br><span class="line">		this.age = age;</span><br><span class="line">	&#125;</span><br><span class="line">	@Override</span><br><span class="line">	public String toString() &#123;</span><br><span class="line">		return &quot;User [id=&quot; + id + &quot;, name=&quot; + name + &quot;, age=&quot; + age + &quot;]&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//用户操作接口</span><br><span class="line">public interface UserService &#123;</span><br><span class="line"></span><br><span class="line">	void add(User user);</span><br><span class="line">	// 。。。</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//接口真实实现</span><br><span class="line">public class UserServiceImpl implements UserService &#123;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public void add(User user) &#123;</span><br><span class="line">		System.out.println(&quot;UserServiceImpl : add user&quot; + user.toString() );</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">//代理类</span><br><span class="line">public class ProxyUserService implements UserService &#123;</span><br><span class="line">	</span><br><span class="line">	private UserService userService;</span><br><span class="line"></span><br><span class="line">	public ProxyUserService(UserService userService) &#123;</span><br><span class="line">		super();</span><br><span class="line">		this.userService = userService;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public void add(User user) &#123;</span><br><span class="line">		System.out.println(&quot;Static Before add&quot;);</span><br><span class="line">		userService.add(user);</span><br><span class="line">		System.out.println(&quot;Static After add&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//代理工厂类</span><br><span class="line">public class ProxyStaticFactory &#123;</span><br><span class="line"></span><br><span class="line">	public static UserService getInstance() &#123;</span><br><span class="line">		return new ProxyUserService(new UserServiceImpl());</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">//测试</span><br><span class="line">public class TestStaticProxy &#123;</span><br><span class="line"></span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		UserService userService = ProxyStaticFactory.getInstance();</span><br><span class="line">		User user = new User();</span><br><span class="line">		user.setId(12);</span><br><span class="line">		user.setName(&quot;哈哈&quot;);</span><br><span class="line">		user.setAge(23);</span><br><span class="line">		userService.add(user);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>结果：<br>Static Before add<br>UserServiceImpl : add userUser [id=12, name=哈哈, age=23]<br>Static After add</p>
</blockquote>
<h2 id="静态代理类优缺点"><a href="#静态代理类优缺点" class="headerlink" title="静态代理类优缺点"></a>静态代理类优缺点</h2><h3 id="优点："><a href="#优点：" class="headerlink" title="优点："></a>优点：</h3><p>业务类只需要关注业务逻辑本身，保证了业务类的重用性。这是代理的共有优点。 </p>
<h3 id="缺点："><a href="#缺点：" class="headerlink" title="缺点："></a>缺点：</h3><p>1）代理对象的一个接口只服务于一种类型的对象，如果要代理的方法很多，势必要为每一种方法都进行代理，静态代理在程序规模稍大时就无法胜任了。<br>2）如果接口增加一个方法，除了所有实现类需要实现这个方法外，所有代理类也需要实现此方法。增加了代码维护的复杂度。 </p>
<h1 id="动态代理"><a href="#动态代理" class="headerlink" title="动态代理"></a>动态代理</h1><blockquote>
<p>动态代理类的源码是在程序运行期间由JVM根据反射等机制动态的生成，所以不存在代理类的字节码文件。代理类和委托类的关系是在程序运行时确定。 </p>
</blockquote>
<h2 id="例子-1"><a href="#例子-1" class="headerlink" title="例子"></a>例子</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">//代理类</span><br><span class="line">public class UserServiceInvocationHandler implements InvocationHandler &#123;</span><br><span class="line"></span><br><span class="line">	private Object delegate;</span><br><span class="line">	</span><br><span class="line">	public UserServiceInvocationHandler(Object delegate) &#123;</span><br><span class="line">		super();</span><br><span class="line">		this.delegate = delegate;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123;</span><br><span class="line">		System.out.println(&quot;Dynamic Before add&quot;);</span><br><span class="line">		Object object = method.invoke(delegate, args);</span><br><span class="line">		System.out.println(&quot;Dynamic After add&quot;);</span><br><span class="line">		return object;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//动态代理工厂类</span><br><span class="line">public class ProxyDynamicFactory &#123;</span><br><span class="line"></span><br><span class="line">	public static UserService getInstance() &#123;</span><br><span class="line">		UserService userService = new UserServiceImpl();</span><br><span class="line">		UserServiceInvocationHandler handler = new UserServiceInvocationHandler(userService);</span><br><span class="line">		return (UserService) Proxy.newProxyInstance(userService.getClass().getClassLoader(), userService.getClass().getInterfaces(), handler);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">//测试</span><br><span class="line">public class TestDynamicProxy &#123;</span><br><span class="line">	</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		UserService userService = ProxyDynamicFactory.getInstance();</span><br><span class="line">		User user = new User();</span><br><span class="line">		user.setId(12);</span><br><span class="line">		user.setName(&quot;哈哈&quot;);</span><br><span class="line">		user.setAge(23);</span><br><span class="line">		userService.add(user);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="创建动态代理过程："><a href="#创建动态代理过程：" class="headerlink" title="创建动态代理过程："></a>创建动态代理过程：</h2><p>一个典型的动态代理创建对象过程可分为以下四个步骤：</p>
<blockquote>
<p>1、通过实现InvocationHandler接口创建自己的调用处理器 IvocationHandler handler = new InvocationHandlerImpl(…);<br>2、通过为Proxy类指定ClassLoader对象和一组interface创建动态代理类<br>Class clazz = Proxy.getProxyClass(classLoader,new Class[]{…});<br>3、通过反射机制获取动态代理类的构造函数，其参数类型是调用处理器接口类型<br>Constructor constructor = clazz.getConstructor(new Class[]{InvocationHandler.class});<br>4、通过构造函数创建代理类实例，此时需将调用处理器对象作为参数被传入<br>Interface Proxy = (Interface)constructor.newInstance(new Object[] (handler));<br>为了简化对象创建过程，Proxy类中的newInstance方法封装了2~4，只需两步即可完成代理对象的创建。<br>生成的ProxySubject继承Proxy类实现Subject接口，实现的Subject的方法实际调用处理器的invoke方法，而invoke方法利用反射调用的是被代理对象的的方法（Object result=method.invoke(proxied,args)）</p>
</blockquote>
<h2 id="动态代理的优点和缺点"><a href="#动态代理的优点和缺点" class="headerlink" title="动态代理的优点和缺点"></a>动态代理的优点和缺点</h2><h3 id="优点：-1"><a href="#优点：-1" class="headerlink" title="优点："></a>优点：</h3><p>动态代理与静态代理相比较，最大的好处是接口中声明的所有方法都被转移到调用处理器一个集中的方法中处理（InvocationHandler.invoke）。这样，在接口方法数量比较多的时候，我们可以进行灵活处理，而不需要像静态代理那样每一个方法进行中转。在本示例中看不出来，因为invoke方法体内嵌入了具体的外围业务（记录任务处理前后时间并计算时间差），实际中可以类似Spring AOP那样配置外围业务。 </p>
<h3 id="缺点：-1"><a href="#缺点：-1" class="headerlink" title="缺点："></a>缺点：</h3><p>诚然，Proxy 已经设计得非常优美，但是还是有一点点小小的遗憾之处，那就是它始终无法摆脱仅支持 interface 代理的桎梏，因为它的设计注定了这个遗憾。回想一下那些动态生成的代理类的继承关系图，它们已经注定有一个共同的父类叫 Proxy。Java 的继承机制注定了这些动态代理类们无法实现对 class 的动态代理，原因是多继承在 Java 中本质上就行不通。<br>有很多条理由，人们可以否定对 class 代理的必要性，但是同样有一些理由，相信支持 class 动态代理会更美好。接口和类的划分，本就不是很明显，只是到了 Java 中才变得如此的细化。如果只从方法的声明及是否被定义来考量，有一种两者的混合体，它的名字叫抽象类。实现对抽象类的动态代理，相信也有其内在的价值。此外，还有一些历史遗留的类，它们将因为没有实现任何接口而从此与动态代理永世无缘。如此种种，不得不说是一个小小的遗憾。 </p>
<h1 id="CGLib的动态代理"><a href="#CGLib的动态代理" class="headerlink" title="CGLib的动态代理"></a>CGLib的动态代理</h1><blockquote>
<p>JDK实现动态代理需要实现类通过接口定义业务方法，对于没有接口的类，如何实现动态代理呢，这就需要CGLib了。CGLib采用了非常底层的字节码技术，其原理是通过字节码技术为一个类创建子类，并在子类中采用方法拦截的技术拦截所有父类方法的调用，顺势织入横切逻辑</p>
</blockquote>
<h2 id="例子-2"><a href="#例子-2" class="headerlink" title="例子"></a>例子</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//pom.xml</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;cglib&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;cglib&lt;/artifactId&gt;</span><br><span class="line">	&lt;version&gt;3.2.4&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//代理类</span><br><span class="line">public class UserServiceCglibMethodInterceptor implements MethodInterceptor &#123;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public Object intercept(Object object, Method method, Object[] objects, MethodProxy methodProxy) throws Throwable &#123;</span><br><span class="line">		System.out.println(&quot;Cglib Before add&quot;);</span><br><span class="line">		Object result = methodProxy.invokeSuper(object, objects);</span><br><span class="line">		System.out.println(&quot;Cglib After add&quot;);</span><br><span class="line">		return result;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//代理工厂</span><br><span class="line">public class ProxyCglibFactory &#123;</span><br><span class="line"></span><br><span class="line">	public static UserService getInstance() &#123;</span><br><span class="line">		Enhancer enhancer = new Enhancer();  </span><br><span class="line">		enhancer.setSuperclass(UserServiceImpl.class);  </span><br><span class="line">		enhancer.setCallback(new UserServiceCglibMethodInterceptor());  </span><br><span class="line">		return (UserServiceImpl)enhancer.create();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">//测试</span><br><span class="line">public class TestCglibProxy &#123;</span><br><span class="line"></span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		UserService userService = ProxyCglibFactory.getInstance();</span><br><span class="line">		User user = new User();</span><br><span class="line">		user.setId(12);</span><br><span class="line">		user.setName(&quot;哈哈&quot;);</span><br><span class="line">		user.setAge(23);</span><br><span class="line">		userService.add(user);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>结果：<br>Cglib Before add<br>UserServiceImpl : add userUser [id=12, name=哈哈, age=23]<br>Cglib After add</p>
</blockquote>
<h2 id="代理对象的生成过程由Enhancer类实现，大概步骤如下："><a href="#代理对象的生成过程由Enhancer类实现，大概步骤如下：" class="headerlink" title="代理对象的生成过程由Enhancer类实现，大概步骤如下："></a>代理对象的生成过程由Enhancer类实现，大概步骤如下：</h2><blockquote>
<p>1、生成代理类Class的二进制字节码；<br>2、通过Class.forName加载二进制字节码，生成Class对象；<br>3、通过反射机制获取实例构造，并初始化代理类对象</p>
</blockquote>
<h1 id="Java自带的动态代理和CGlib的动态代理实现的区别"><a href="#Java自带的动态代理和CGlib的动态代理实现的区别" class="headerlink" title="Java自带的动态代理和CGlib的动态代理实现的区别"></a>Java自带的动态代理和CGlib的动态代理实现的区别</h1><blockquote>
<p>1、jdk动态代理生成的代理类和委托类实现了相同的接口；<br>2、cglib动态代理中生成的字节码更加复杂，生成的代理类是委托类的子类，且不能处理被final关键字修饰的方法；<br>3、jdk采用反射机制调用委托类的方法，cglib采用类似索引的方式直接调用委托类方法；</p>
</blockquote>
<h1 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h1><p><a href="http://www.cnblogs.com/chinajava/p/5880887.html" target="_blank" rel="noopener">说说cglib动态代理 </a><br><a href="http://www.cnblogs.com/mengdd/archive/2013/01/30/2883468.html" target="_blank" rel="noopener">Java 代理模式（一） 静态代理</a><br><a href="http://blog.csdn.net/hejingyuan6/article/details/36203505" target="_blank" rel="noopener">JAVA学习篇–静态代理VS动态代理 </a><br><a href="http://layznet.iteye.com/blog/1182924" target="_blank" rel="noopener">java静态代理和动态代理 </a><br><a href="http://www.ibm.com/developerworks/cn/java/j-lo-proxy1/index.html" target="_blank" rel="noopener">Java 动态代理机制分析及扩展，第 1 部分</a><br><a href="http://rejoy.iteye.com/blog/1627405" target="_blank" rel="noopener">JDK动态代理实现原理</a><br><a href="http://www.cnblogs.com/flyoung2008/archive/2013/08/11/3251148.html" target="_blank" rel="noopener">彻底理解JAVA动态代理</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/19/生活如此/" itemprop="url">
                  生活如此
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-02-19T22:00:00+08:00" content="2017-02-19">
              2017-02-19
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/生活人生/" itemprop="url" rel="index">
                    <span itemprop="name">生活人生</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/02/19/生活如此/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/02/19/生活如此/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/02/19/生活如此/" class="leancloud_visitors" data-flag-title="生活如此">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;文章把它命名为《生活如此》，一是真的不知道要起什么名字；二是最近这段时间确实发生了一些东西，想记录下这些事情，把它变成可追寻的记忆。<br>&emsp;&emsp;文章就随性而写，想到什么就写什么。其实我经常有这个担忧，生怕自己写的东西有人不喜欢，以至于不敢把自己的见解发表出来，所以之前写的东西基本都是技术类的，把自己学习到的网上众多网友认可的知识传播分享，这种大家都认可的技术类博客可能就不会引起歧义。我发现这种想法不仅仅发生在写博客这件事上，而且充斥着我生活的点滴，比如：遇到问题自己没有花上一段可观的时间前不会去问别人，生怕别人会鄙视我这个问题，甚至鄙视我的能力，也许别人只需要2分钟就可以让我了解得很深透；在生活上，特别是和别人合租，总是怕去打扰到别人，走路走得小心翼翼，电脑不敢开扬声器，尽管不喜欢挂着耳机，等等很多方面。一直在思考这个问题，到底是什么原因？不自信？思虑太多？优柔寡断？现在也只能抛出这个问题，因为还停留在思考的阶段，还没有去发现真正的问题原因。现在唯一能做的就是改变，尝试去改变这些种种做法。<br>&emsp;&emsp;女朋友上班午餐都是和同事一起煮饭吃，这周四同事买到的空心菜可能残留了农药，吃完到了晚上集体都呕吐、反胃、不舒服，才意识到食物中毒了。当时女朋友跟我说后，我的反应是：需要赶紧去医院，去检查是什么东西导致食物中毒，如果是一些毒性比较大的农药残留，可能会危及生命。因为和女朋友一直是异地恋，她在老家那，所以我没能去带她去医院。跟女朋友说了需要去医院的时候，她觉得不用去医院，觉得麻烦，但是我一再跟她解释，需要分轻重，如果是普通感冒，去周围邻近的诊所没关系，但是食物中毒可大可小，况且现在还不知道是什么农药还是其他东西导致食物中毒的，讲了一大堆我的想法后，最终她爸爸还是带她去了附近的诊所，诊所的医生也只是说轻微食物中毒，拿了一些药片，但是终究还是不知道什么导致食物中毒。女朋友吃完药后第二天还是没有好转，我再次说要去医院看，她还是没去，第二天下午去另一个私人诊所看了。我当时问她身边的同事没有一个人去医院看么？她说是的。后来我也只能祈祷吃了医生的药片能好，重新恢复健康。其实从这件事情，我发现这种不是说去不去医院看病的问题了，可以上升到思想的层面，怎么说呢，就是<strong>思想决定行为</strong>。从我的角度上说：我有觉得生病了，需要去分清轻重，诊所毕竟只能解决小问题，不知道深浅的病需要去医院看，医院有条件可以查清楚病因，但是诊所只有通过生病的一些病征去判断，这是我的想法，我从农村到城市，慢慢习惯城市的生活，所以我会觉得根据病况判断需不需要去医院。从老家的人的角度上说：他们已经在农村生活了几十年的，所以他们的想法就是去诊所看病，直到如果真的诊所解决不了才去医院，其实这其中如果是一些大的病，就会被耽误了。从城市人的角度上说：从小生活在城市上的人们，也许从小到大不管生什么病，他们都往医院去，也许他们的思想是不管什么病都去医院。当然这些都是我个人的臆想，很多东西上升到思想层面就很难改变了。<br>&emsp;&emsp;周五晚上不想去参加公司篮球俱乐部的打篮球活动，也不想那么早回家，所以就约了辉哥一起吃个晚饭。期间聊到了很多东西，主要有对IT职业的一些讨论，他最近有打算要跳槽，也面试过一家服装类的企业的IT部门，我们讨论了跳槽的一些准备，我们都是去年7月份毕业，到现在过了7个月，不过辉哥是从大三暑假就开始在这里实习，其实他已经工作了一年半了，也是一个跳槽的阶段吧，到了一家公司工作，如果不是互联网大企业的话，工作了一年半，基本已经掌握了这家公司的开发技术了，再往后大多数是接触到或者能够成长的可能是业务方面。不过跳槽是一门艺术，在我看来，跳槽需要做很多准备，特别是当你的工作经验不能给你很大加成的时候，你更需要去准备充分，可能需要去看在工作上没深入用的技术点，但是不管你的工作经验有多好或者多差，你一定得在跳槽前去做深入的总结，总结你工作这段时间的经历，工作上也好、生活上也罢、甚至思想上，这各方面都是有成长也有收获的，再好的项目经验，不会把它的牛逼表达出来，也没有用。当然我现在的想法可能是一个刚工作半年的工作者的想法，可能还没有完全摆脱学生时的思维，也不能叫摆脱，叫还没有在学生的思维上成长很多吧。<br>&emsp;&emsp;周六那天中午和同事一起聚餐，第一次吃上久闻大名的“八合里”牛肉火锅，作为一个地道的潮汕人，觉得“八合里”确实挺地道的，特别是芥蓝牛河，不过在老家的话炒芥蓝牛河会将牛肉和河粉分开炒，炒牛肉会有些酱，然后将牛肉和酱一起淋在河粉上，那样会觉得更好吃一些。吃完午饭和同事一起去逛月亮湾公园，聊了很多关于童年的趣事，在一个小湖栈道上看到湖边的一个小小的乌龟在那里觅食，想起如果是小时候的我们，那肯定会跳到湖边去抓这只小乌龟。附上这小乌龟的美照（考验你的眼力的时候到了）</p>
<p><center><br><img src="https://1csh1.github.io/img/生活如此/tortoise1.jpg" alt="小乌龟"><br><img src="https://1csh1.github.io/img/生活如此/tortoise2.jpg" alt="小乌龟"><br></center><br>&emsp;&emsp;晚上艺的2个朋友来做客，在大学的时候有次去找艺的时候，见过他们2人，所以也算认识，他们也是IT行业的，是做嵌入式方面的，德兄是在TPLink，桶兄忘记是哪家公司的了，和他们聊了工作方面的情况，因为大家都是IT行业的，所以共同话题还是很多的。艺也发了微信过来，介绍了一篇文章<a href="http://mp.weixin.qq.com/s?__biz=MjM5OTA1MDUyMA==&amp;mid=2655437863&amp;idx=1&amp;sn=67ff6deffc656cc1335b428434fed5ba&amp;chksm=bd7308508a04814685c2a1e67bd4a86e502edc38dc9eda7ebe3d93d8fdf0997dcc7dd45f6047&amp;mpshare=1&amp;scene=1&amp;srcid=0218wMh273u9vk4PMh6C09w7#rd" target="_blank" rel="noopener">技术人员的发展之路</a>，说了他最近对未来有些恐惧，我们聊了一些关于成长，如何变得更好，我谈到了我的想法：接下来会去适度去接外包项目来做，这个想法起源于我跟辉哥的一次交谈。年前最后一个周末我去了坪洲找了辉哥，我就把那段时间一直困惑我的一个问题抛出来和辉哥讨论，问题是这样的：在工作之余，有空闲的时间你会做什么？A是学习一些感兴趣的新的技术，可能在未来某一天跳槽有用；B是用现有掌握的技术去接外包项目。我为什么会有这个疑问呢？从我的经历方面促使我会有这个问题困扰，我回顾了大学4年，这4年什么时间段是我收获最大的？是大二到大三那段不知道要学习什么突然在网上找到马士兵的Java视频，了解到有一套深入学习JavaWeb方面的教程，然后马不停蹄地学习，然后参加工作室参与项目开发，到后面接手老师的一个果实溯源的项目，一步一步通过项目把学习的东西给应用并更好地掌握，这几个环节最深刻是做项目，也给我带来收获最大。到后来就没有这样的一个经历了，去参加实习，到现在正式工作，虽然空闲时间还是会去学习感兴趣的东西，但是我发现学完就忘，是因为没有一个应用场景，没有一个项目去促使你牢固地掌握学习的知识。通过这件事促使我思考了这个问题，我在这个问题上迷茫了。当我问辉哥的时候，他给了一个非常肯定的答案，B。他给的解释是：A中的学习新技术的目的是什么？让你找到更好的工作还是其他，但是你希望它最终变为收入，俗一点说就是钱。但是我们知道学习开发技术，需要项目驱动学习，如果只是单纯学习，那么久会出现学完就忘，如果你有项目可以去驱动你学习，那选A无疑，但是如果没有，那么为啥不把你现在所掌握的技术变现呢？也就是说接外包去赚外快。接外包其实不简单，当你接到一个项目，需要涉及你不会的技术的时候，这个时候就是项目驱动你学习新技术了，或者说学习你不会的技术，这也是一个成长。从这次交谈之后，我发现也许真的得去尝试B这个做法。我跟艺谈了这个想法之后，他也很触动，我觉得<strong>现在的迷茫都只是为了看到未来的光明</strong>。<br>&emsp;&emsp;晚上和大只聊天聊到了3:40才睡觉，聊了从小在各自的家庭中因为贫穷被亲人看不起，聊了老家中一些让人理解不了的做事风格，聊了各自对家乡的风俗地抵制，聊了各自工作的职业规划。。。<br>&emsp;&emsp;以前我总觉得博客是用来写技术的，但是我现在不觉得，它可以用来分享技术，也可以用来分享生活，分享一切的一切。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/24/搭建RabbitMQ集群/" itemprop="url">
                  搭建RabbitMQ集群
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-01-24T21:32:00+08:00" content="2017-01-24">
              2017-01-24
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/RabbitMQ/" itemprop="url" rel="index">
                    <span itemprop="name">RabbitMQ</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/01/24/搭建RabbitMQ集群/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/01/24/搭建RabbitMQ集群/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/01/24/搭建RabbitMQ集群/" class="leancloud_visitors" data-flag-title="搭建RabbitMQ集群">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="闲话"><a href="#闲话" class="headerlink" title="闲话"></a>闲话</h3><p>&emsp;&emsp;本文讲述搭建RabbitMQ集群，文中总共用了3个节点node6,node7,node8。</p>
<h3 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h3><p>将node6,node7,node8的.erlang.cookie文件内容设置为一样的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//在node6节点上</span><br><span class="line">cat /var/lib/rabbitmq/.erlang.cookie</span><br><span class="line">//将内容复制到node7,node8节点上，可能需要修改文件的权限</span><br><span class="line"></span><br><span class="line">//结果：比如我自己的机器上的.erlang.cookie文件内容</span><br><span class="line">rabbit6  ETIEGPLEHVXLJDVZGLMF</span><br><span class="line">rabbit7  ETIEGPLEHVXLJDVZGLMF</span><br><span class="line">rabbit8  ETIEGPLEHVXLJDVZGLMF</span><br></pre></td></tr></table></figure></p>
<h3 id="启动RabbitMQ"><a href="#启动RabbitMQ" class="headerlink" title="启动RabbitMQ"></a>启动RabbitMQ</h3><p>在node6上运行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RABBITMQ_NODE_PORT=5672 RABBITMQ_NODENAME=rabbit6 \rabbitmq-server -detached</span><br></pre></td></tr></table></figure></p>
<p>在node7上运行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RABBITMQ_NODE_PORT=5672 RABBITMQ_NODENAME=rabbit7 \rabbitmq-server -detached</span><br></pre></td></tr></table></figure></p>
<p>在node8上运行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RABBITMQ_NODE_PORT=5672 RABBITMQ_NODENAME=rabbit8 \rabbitmq-server -detached</span><br></pre></td></tr></table></figure></p>
<h3 id="将node7节点加入到集群中"><a href="#将node7节点加入到集群中" class="headerlink" title="将node7节点加入到集群中"></a>将node7节点加入到集群中</h3><p>在node7机器上运行如下命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//停止rabbit7节点上的RabbitMQ应用程序</span><br><span class="line">rabbitmqctl -n rabbit7@csh07 stop_app</span><br><span class="line"></span><br><span class="line">//重设rabbit7节点的元数据和状态为清空</span><br><span class="line">rabbitmqctl -n rabbit7@csh07 reset</span><br><span class="line"></span><br><span class="line">//将rabbit7加入到rabbit6集群中</span><br><span class="line">rabbitmqctl -n rabbit7@csh07 join_cluster rabbit6@csh06 \ rabbit7@csh07</span><br><span class="line"></span><br><span class="line">//重新启动rabbit7节点的应用程序</span><br><span class="line">rabbitmqctl -n rabbit7@csh07 start_app</span><br></pre></td></tr></table></figure></p>
<h3 id="将node8节点加入到集群中"><a href="#将node8节点加入到集群中" class="headerlink" title="将node8节点加入到集群中"></a>将node8节点加入到集群中</h3><p>在node8机器上运行如下命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl -n rabbit8@csh08 stop_app</span><br><span class="line">rabbitmqctl -n rabbit8@csh08 reset</span><br><span class="line">rabbitmqctl -n rabbit8@csh08 join_cluster rabbit6@csh06</span><br><span class="line">rabbitmqctl -n rabbit8@csh08 start_app</span><br></pre></td></tr></table></figure></p>
<h3 id="查看集群状态"><a href="#查看集群状态" class="headerlink" title="查看集群状态"></a>查看集群状态</h3><p>命令如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl cluster_status</span><br></pre></td></tr></table></figure></p>
<p>结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@csh08 ~]# rabbitmqctl -n rabbit8@csh08 cluster_status</span><br><span class="line">Cluster status of node &apos;rabbit8@csh08&apos; ...</span><br><span class="line">[&#123;nodes,[&#123;disc,[&apos;rabbit7@csh07&apos;,&apos;rabbit6@csh06&apos;]&#125;,</span><br><span class="line">         &#123;ram,[&apos;rabbit8@csh08&apos;]&#125;]&#125;,</span><br><span class="line"> &#123;running_nodes,[&apos;rabbit6@csh06&apos;,&apos;rabbit7@csh07&apos;,</span><br><span class="line">                 &apos;rabbit8@csh08&apos;]&#125;,</span><br><span class="line"> &#123;cluster_name,&lt;&lt;&quot;rabbit6@csh06.itc.cmbchina.cn&quot;&gt;&gt;&#125;,</span><br><span class="line"> &#123;partitions,[]&#125;,</span><br><span class="line"> &#123;alarms,[&#123;&apos;rabbit6@csh06&apos;,[]&#125;,</span><br><span class="line">          &#123;&apos;rabbit7@csh07&apos;,[]&#125;,</span><br><span class="line">          &#123;&apos;rabbit8@csh08&apos;,[]&#125;]&#125;]</span><br></pre></td></tr></table></figure></p>
<h3 id="将节点从集群中移除"><a href="#将节点从集群中移除" class="headerlink" title="将节点从集群中移除"></a>将节点从集群中移除</h3><p>命令如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl -n rabbit8@csh08 stop_app</span><br><span class="line">rabbitmqctl -n rabbit8@csh08 reset</span><br><span class="line">rabbitmqctl -n rabbit8@csh08 start_app</span><br></pre></td></tr></table></figure></p>
<h3 id="可能遇到问题"><a href="#可能遇到问题" class="headerlink" title="可能遇到问题"></a>可能遇到问题</h3><p>在添加节点node7到node6上时，遇到连接不上node6节点机器<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@csh07 ~]# rabbitmqctl -n rabbit7@csh07 join_cluster rabbit6@csh06</span><br><span class="line">Clustering node &apos;rabbit7@csh07&apos; with &apos;rabbit6@csh06&apos; ...</span><br><span class="line">Error: unable to connect to nodes [&apos;rabbit6@csh06&apos;]: nodedown</span><br><span class="line"></span><br><span class="line">DIAGNOSTICS</span><br><span class="line">===========</span><br><span class="line"></span><br><span class="line">attempted to contact: [&apos;rabbit6@csh06&apos;]</span><br><span class="line"></span><br><span class="line">rabbit6@csh06:</span><br><span class="line">  * unable to connect to epmd (port 4369) on csh06: nxdomain (non-existing domain)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">current node details:</span><br><span class="line">- node name: &apos;rabbitmq-cli-45@csh07&apos;</span><br><span class="line">- home dir: /var/lib/rabbitmq</span><br><span class="line">- cookie hash: a5xQrcy5rMqVgP/ZCwWUPA==</span><br></pre></td></tr></table></figure></p>
<p>解决：<br>在所有机器上的/etc/hosts文件加上如下配置，主要是添加csh06,csh07,csh08映射<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">192.168.1.6 node6 csh06</span><br><span class="line">192.168.1.7 node7 csh07</span><br><span class="line">192.168.1.8 node8 csh08</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/16/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/16/">16</a><span class="page-number current">17</span><a class="page-number" href="/page/18/">18</a><span class="space">&hellip;</span><a class="page-number" href="/page/24/">24</a><a class="extend next" rel="next" href="/page/18/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/default_avatar.jpg"
               alt="James-CSH" />
          <p class="site-author-name" itemprop="name">James-CSH</p>
          <p class="site-description motion-element" itemprop="description">当才华撑不起野心时，应该静下心来学习；当能力驾驭不了目标时，应该沉下心来历练。</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">120</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">38</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">138</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        <div class="links-of-blogroll motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script type="text/javascript" src="http://tajs.qq.com/stats?sId=55186219" charset="UTF-8"></script>
<script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script>
<script>
    const btw = new BTWPlugin();
    btw.init({
        id: 'content',
        blogId: '15497-1572145892011-295',
        name: 'LieBrother',
        qrcode: 'http://www.liebrother.com/upload/2ead36875d2647ef9f857b904cdbb3e6_.jpg',
        keyword: 'github',
    });
</script>
<div class="copyright" >
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">James-CSH</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

<div>
<span id="busuanzi_container_site_uv">
  本站访客数<span id="busuanzi_value_site_uv"></span>人次
</span>
&nbsp;|&nbsp;
<span id="busuanzi_container_site_pv">
    本站总访问量<span id="busuanzi_value_site_pv"></span>次
</span>
</div>



      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  


  




<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=0.5.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=0.5.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=0.5.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"1CSH1"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
  





  
  
  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("eodGFnKXWTUNhQKhMktCLDNj-gzGzoHsz", "iC7dXG3oqjDHhiy0K3MmaIlE");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



</body>
</html>
